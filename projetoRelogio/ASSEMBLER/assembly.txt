%LABEL LOOP_INICIALIZACAO
JSR @SR_INICIALIZAR_MEMORIA
NOP
JSR @SR_REFRESH_DISPLAY
NOP

%LABEL MAIN_LOOP
JSR @SR_INCREMENTO_HORARIO
NOP
JSR @SR_REFRESH_DISPLAY
NOP

JMP @MAIN_LOOP
NOP

%LABEL SR_INICIALIZAR_MEMORIA
LDI R0, $0
LDI R1, $1
LDI R2, $9

STA R0, @ADDR_COUNTER_SEG_UN    
STA R0, @ADDR_COUNTER_SEG_DEZ   
STA R0, @ADDR_COUNTER_MIN_UN    
STA R0, @ADDR_COUNTER_MIN_DEZ   
STA R0, @ADDR_COUNTER_HOR_UN    
STA R0, @ADDR_COUNTER_HOR_DEZ   

STA R0, @ADDR_LIMIT_SEG_UN
STA R0, @ADDR_LIMIT_SEG_DEZ
STA R0, @ADDR_LIMIT_MIN_UN
STA R0, @ADDR_LIMIT_MIN_DEZ
STA R0, @ADDR_LIMIT_HOR_UN
STA R0, @ADDR_LIMIT_HOR_DEZ

STA R0, @FPGA_RESET
STA R0, @LEDR
RET


%LABEL SR_REFRESH_DISPLAY
LDA R3, @ADDR_COUNTER_SEG_UN     #-- LOAD UNIDADE
STA R3, @HEX0                    #-- ARMAZENA EM HEX0
LDA R3, @ADDR_COUNTER_SEG_DEZ    #-- LOAD DEZENA 
STA R3, @HEX1                    #-- ARMAZENA EM HEX1
LDA R3, @ADDR_COUNTER_MIN_UN     #-- LOAD CENTENA
STA R3, @HEX2                    #-- ARMAZENA EM HEX2
LDA R3, @ADDR_COUNTER_MIN_DEZ    #-- LOAD MILHAR
STA R3, @HEX3                    #-- ARMAZENA EM HEX3
LDA R3, @ADDR_COUNTER_HOR_UN     #-- LOAD DEZ.MILHAR 
STA R3, @HEX4                    #-- ARMAZENA EM HEX4
LDA R3, @ADDR_COUNTER_HOR_DEZ    #-- LOAD CEN.MILHAR 
STA R3, @HEX5                    #-- ARMAZENA EM HEX5
RET



%LABEL SR_INCREMENTO_HORARIO

CEQ  R1, @KEY0                    # KEY0 == 1?
JEQ  @SR_INCREMENTO_SEG_UN        # IF (key0 == 1 (apertado)): {incrementa}
NOP
RET 

%LABEL SR_INCREMENTO_SEG_UN
STA  R0, @CLEAR_KEY0              #Reset KEY0 
CEQ  R2, @ADDR_COUNTER_SEG_UN     #Unidade segundo == 9?
JEQ  @SR_INCREMENTO_SEG_DEZ       #if (Un Seg == 9): Dez Seg += 1
NOP
LDA  R3, @ADDR_CTE1
SOMA R3, @ADDR_COUNTER_SEG_UN     #else (un seg!=9) : un seg +=1
STA  R3, @ADDR_COUNTER_SEG_UN    
RET 

%LABEL SR_INCREMENTO_SEG_DEZ
STA R0, @ADDR_COUNTER_SEG_UN

CEQ R2, @ADDR_COUNTER_SEG_DEZ    #SEG DEZ == 9?
JEQ @SR_INCREMENTO_MIN_UN        #if (dez seg==9) : un min += 1
NOP 
LDA  R3, @ADDR_CTE1           #else (dez seg!=9) : dez seg += 1
SOMA R3, @ADDR_COUNTER_SEG_DEZ           #else (dez seg!=9) : dez seg += 1
STA  R3, @ADDR_COUNTER_SEG_DEZ           #else (dez seg!=9) : dez seg += 1
RET

%LABEL SR_INCREMENTO_MIN_UN
STA R0, @ADDR_COUNTER_SEG_DEZ
STA R1, @ADDR_COUNTER_MIN_UN

NOP
RET